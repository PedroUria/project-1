---
title: "Telco_EDA"
author: "zbuckley"
date: "October 5, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("nuisance_reducer.R")
```

# Nuisance_Reducer

Using the Nuisance Reducer script we can hide away useful utilities... like loading in a cleaned up data.frame of the telco data.

# Load Telco DataFrame

Load Telco Data into a DataFrame, and change a large number of the fields to factor variables

```{r load} 
#helper function in nuisance_reducer.R
telco <- get_telco_data()
```

# Data Exploration

Combining things into yes and no

```{r add_agg}
package_apply_all(c('dplyr'), require)

##list of cols that need to be converted back to factors after changes
cols.factor.type <- vars(StreamingTV, StreamingMovies, InternetService)

# TODO: Can this be generalized using ... undefined arguments thingy?
count_services <- function(a,b,c,d) {
  val <- 0
  #TODO: had trouble turning this into loop... should take another look
  if (a == "Yes") val <- val + 1
  if (b == "Yes") val <- val + 1
  if (c == "Yes") val <- val + 1
  if (d == "Yes") val <- val + 1
  val
}

telco <- telco %>%
  mutate(
    StreamingTV = gsub(" internet service", "", StreamingTV), # 'no internet service' should just be No
    StreamingMovies = gsub(" internet service", "", StreamingMovies), # 'no internet service' should just be No
    InternetService = gsub("DSL", "Yes", InternetService), # DSL changed to Yes
    InternetService = gsub("Fiber optic", "Yes", InternetService) # Fiber changed to Yes
  ) %>%
  mutate_at(
    # change cols we touched back to factors
    vars(StreamingTV, StreamingMovies, InternetService), 
    funs(factor)
  ) %>% rowwise() %>% 
  mutate(
    #add service_count column containing numbers of services each customer has
    service_count = count_services(StreamingTV, StreamingMovies, InternetService, PhoneService)
  )

str(telco)
```

##Chi-squared stuff

```{r}
package_apply_all(c('vcd'), require)

thing <- chisq.test(telco$Churn,telco[['Contract']])
str(thing)

names <- names(Filter(is.factor, telco))
names

i <- 0
results <- list()
for (n in names) {
  i <- i + 1
  results[[i]] <- list(n, chisq.test(telco$Churn, telco[[n]]))
 # print(n)
  #print(results[[i]])
}

#print(results)


printShit <- function(x) {
  print(results[[x]][[1]])
  print("observed")
  print(results[[x]][[2]]$observed)
  print("expected")
  print(results[[x]][[2]]$expected)
  print("residuals")
  print(results[[x]][[2]]$residuals)
  print("p.value")
  print(results[[x]][[2]]$p.value)
}

#printShit(2)


```

#wtf

Chi-Squared null hypothesis is no relationship between variables

if p-value < .05 reject that and is a relationship between variables




